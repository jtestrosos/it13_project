@page "/inventory"
@layout DashboardLayout

@using PharmacyManagementSystem.Services
@using System.Text
@using System.Linq
@using System;


<PageTitle>Medicine Inventory - PharmERP</PageTitle>

<div class="h-full bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-6">
    <div class="flex items-center justify-between mb-6">
        <div>
            <h1 class="text-2xl font-bold text-white">Medicine Inventory</h1>
            <p class="text-slate-400 mt-1">Manage your pharmacy stock and inventory</p>
        </div>
        @if (userRole == "Admin" || userRole == "SuperAdmin")
        {
        <button @onclick="() => OpenModal(null)"
                class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg flex items-center space-x-2 transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            <span class="font-medium">Add Medicine</span>
        </button>
        }
    </div>

    <div class="bg-slate-800/50 backdrop-blur-sm rounded-xl border border-slate-700/50 overflow-hidden">
        <div class="p-6 border-b border-slate-700/50">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-white">Medicine List</h2>
                <div class="flex items-center space-x-3">
                    <div class="relative">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                            </svg>
                        </span>
                        <input type="search" @bind="SearchTerm" @bind:event="oninput"
                               placeholder="     Search medicines..."
                               class="pl-10 pr-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-blue-500 w-64">
                    </div>


                    <select @bind="SelectedCategory"
                            class="px-4 py-2 bg-slate-700 border border-slate-600 rounded-lg text-white appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">All Categories</option>
                        @foreach (var category in UniqueCategories)
                        {
                            <option value="@category">@category</option>
                        }
                    </select>


                    <button @onclick="ExportData"
                            class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-slate-300 rounded-lg flex items-center space-x-2 border border-slate-600">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        <span>Export</span>
                    </button>
                </div>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-700">
                <thead class="bg-slate-700/50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Name</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Generic</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Category</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Qty</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Price</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Expiry</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Supplier</th>
                        @if (userRole == "Admin" || userRole == "SuperAdmin")
                        {
                        <th class="px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider">Actions</th>
                        }
                    </tr>
                </thead>
                <tbody class="bg-slate-800/30 divide-y divide-slate-700">
                    @if (FilteredMedicines != null)
                    {
                        @foreach (var medicine in FilteredMedicines)
                        {
                            var rowClass = "hover:bg-slate-700/50"; 
                            string qtyColor = "text-slate-300";

                            if (medicine.Quantity <= 0)
                            {
                                rowClass = "bg-red-950/40 hover:bg-red-900/50 border-l-4 border-red-500";
                                qtyColor = "text-red-400 font-bold";
                            }
                            else if (medicine.Quantity <= medicine.MinQuantity)
                            {
                                rowClass = "bg-orange-950/40 hover:bg-orange-900/50 border-l-4 border-orange-500";
                                qtyColor = "text-orange-400 font-bold";
                            }
                            else
                            {
                                rowClass = "bg-emerald-950/20 hover:bg-emerald-900/30 border-l-4 border-emerald-500";
                                qtyColor = "text-emerald-400 font-bold";
                            }

                            <tr class="@rowClass transition-all duration-200">
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">@medicine.Name</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">@medicine.GenericName</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">@medicine.Category</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm @qtyColor">@medicine.Quantity</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">$@medicine.Price.ToString("F2")</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">@medicine.ExpiryDate.ToShortDateString()</td>

                                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-300">
                                    @medicine.Manufacturer
                                </td>

                                @if (userRole == "Admin" || userRole == "SuperAdmin")
                                {
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                    <button @onclick="() => OpenStockModal(medicine, false)" class="text-orange-400 hover:text-orange-300 mr-2" title="Stock Out">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4" />
                                        </svg>
                                    </button>
                                    <button @onclick="() => OpenModal(medicine)" class="text-indigo-400 hover:text-indigo-300 mr-2">Edit</button>
                                    <button @onclick="() => DeleteMedicine(medicine)" class="text-red-400 hover:text-red-300">Archive</button>
                                </td>
                                }
                            </tr>
                        }
                    }
                </tbody>
            </table>
        </div>

        @if (Medicines.Any() != true)
        {
            <div class="p-20 text-center text-slate-500">
                <svg class="w-20 h-20 mx-auto mb-4 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                </svg>
                <p class="text-lg font-medium">No medicines in inventory</p>
                <p class="text-sm mt-2">Click "Add Medicine" to get started</p>
            </div>
        }
    </div>
</div>

@if (showModal)
{

    <div class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl shadow-2xl w-full max-w-4xl border border-slate-700">
            <div class="flex items-center justify-between p-6 border-b border-slate-700">
                <div>
                    <h2 class="text-2xl font-bold text-white">
                        @(currentMedicine.MedicineId == 0 ? "Add New Medicine" : "Edit Medicine")
                    </h2>
                    <p class="text-slate-400 text-sm mt-1">Enter medicine details to add to inventory</p>
                </div>
                <button @onclick="() => showModal = false" class="text-slate-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-5">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Medicine Name</label>
                            <input @bind="currentMedicine.Name"
                                   class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500"
                                   placeholder="e.g. Amoxicillin 500mg" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Generic Name</label>
                            <input @bind="currentMedicine.GenericName"
                                   class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white"
                                   placeholder="e.g. Amoxicillin" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Category</label>
                            <select @bind="currentMedicine.Category"
                                    class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Antibiotics">Antibiotics</option>
                                <option value="Painkillers">Painkillers</option>
                                <option value="Diabetes">Diabetes</option>
                                <option value="Cardiac">Cardiac</option>
                                <option value="Vitamins">Vitamins</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Min Stock Level</label>
                            <input @bind="currentMedicine.MinQuantity" type="number"
                                   class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white" />
                        </div>
                    </div>

                    <div class="space-y-5">
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Manufacturer</label>
                            <select @bind="currentMedicine.Manufacturer"
                                    class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">— Select Manufacturer —</option>
                                @foreach (var supplier in Suppliers)
                                {
                                    <option value="@supplier.Name">@supplier.Name</option>
                                }
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Price ($)</label>
                            <input @bind="currentMedicine.Price" type="number" step="0.01"
                                   class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-300 mb-2">Storage Location</label>
                            <input @bind="currentMedicine.StorageLocation"
                                   class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white"
                                   placeholder="e.g. Shelf A-12" />
                        </div>
                        <div class="invisible">
                            <label class="block text-sm font-medium text-slate-300 mb-2">&nbsp;</label>
                            <input class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white" disabled />
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-end space-x-4 px-6 pb-6">
                <button @onclick="() => showModal = false"
                        class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl transition-colors font-medium">
                    Cancel
                </button>
                <button @onclick="SaveMedicine"
                        class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-colors font-medium shadow-lg">
                    @(currentMedicine.MedicineId == 0 ? "Add Medicine" : "Update Medicine")
                </button>
            </div>
        </div>
    </div>
}

@if (showStockModal)
{
    <div class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4">
        <div class="bg-slate-800 rounded-2xl shadow-2xl w-full max-w-md border border-slate-700">
            <div class="flex items-center justify-between p-6 border-b border-slate-700">
                <div>
                    <h2 class="text-2xl font-bold @(isStockIn ? "text-emerald-400" : "text-orange-400")">
                        @(isStockIn ? "Stock In" : "Stock Out")
                    </h2>
                    <p class="text-slate-400 text-sm mt-1">Adjust quantity for @selectedStockMedicine.Name</p>
                </div>
                <button @onclick="() => showStockModal = false" class="text-slate-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div class="p-6 space-y-5">
                <div class="bg-slate-700/50 p-4 rounded-xl border border-slate-600">
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-slate-400 text-sm">Current Stock</span>
                        <span class="text-xl font-bold text-white">@selectedStockMedicine.Quantity</span>
                    </div>
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-slate-400 text-sm">Min Stock Level</span>
                        <span class="text-sm font-medium text-slate-300">@selectedStockMedicine.MinQuantity</span>
                    </div>
                    <div class="w-full bg-slate-700 rounded-full h-2 mt-2">
                        <div class="bg-blue-500 h-2 rounded-full" style="width: @(Math.Min(100, (selectedStockMedicine.Quantity * 100) / Math.Max(1, selectedStockMedicine.MinQuantity)))%"></div>
                    </div>
                </div>

                <div>
                    @if (isStockIn)
                    {
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Quantity to Add</label>
                                <input @bind="stockInModel.Quantity" type="number" min="1"
                                       class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Delivery Date</label>
                                <input @bind="stockInModel.DeliveryDate" type="date"
                                       class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Expiry Date</label>
                                <input @bind="stockInModel.ExpiryDate" type="date"
                                       class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-emerald-500" />
                            </div>
                        </div>
                    }
                    else
                    {
                         <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Quantity to Remove</label>
                                <input @bind="stockOutModel.Quantity" type="number" min="1"
                                       class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-orange-500" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">Reason</label>
                                <select @bind="stockOutModel.Reason"
                                        class="w-full px-4 py-3 bg-slate-700/70 border border-slate-600 rounded-xl text-white focus:outline-none focus:ring-2 focus:ring-orange-500">
                                    <option value="Damaged">Damaged</option>
                                    <option value="Expired">Expired</option>
                                    <option value="Lost">Lost</option>
                                    <option value="Correction">Correction</option>
                                </select>
                            </div>
                        </div>
                    }
                </div>
            </div>

            <div class="flex justify-end space-x-4 px-6 pb-6">
                <button @onclick="() => showStockModal = false"
                        class="px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-xl transition-colors font-medium">
                    Cancel
                </button>
                <button @onclick="SaveStockAdjustment"
                        class="px-8 py-3 @(isStockIn ? "bg-emerald-600 hover:bg-emerald-700" : "bg-orange-600 hover:bg-orange-700") text-white rounded-xl transition-colors font-medium shadow-lg">
                    Confirm @(isStockIn ? "Stock In" : "Stock Out")
                </button>
            </div>
        </div>
    </div>
}

@code {
    [Inject]
    public IMedicineService MedicineService { get; set; } = default!;
    [Inject]
    public IJSRuntime JS { get; set; } = default!;
    [Inject]
    public ISupplierService SupplierService { get; set; } = default!;

    private string SearchTerm = "";
    private string SelectedCategory = "";
    private bool showModal = false;
    private bool showStockModal = false;
    private bool isStockIn = true;
    private PharmacyManagementSystem.Services.Medicines selectedStockMedicine = new();
    
    private StockInTransaction stockInModel = new();
    private StockOutTransaction stockOutModel = new();


    private PharmacyManagementSystem.Services.Medicines currentMedicine = new();
    private string userRole = "";


    private List<PharmacyManagementSystem.Services.Medicines> Medicines { get; set; } = new();
    private List<PharmacyManagementSystem.Services.Supplier> Suppliers { get; set; } = new();

    private IEnumerable<string> UniqueCategories => Medicines.Select(m => m.Category).Distinct().OrderBy(c => c);

    protected override async Task OnInitializedAsync()
    {
        try
        {
            userRole = await JS.InvokeAsync<string>("localStorage.getItem", "userRole") ?? "Staff";
        }
        catch { userRole = "Staff"; }
        
        await LoadData();
    }

    private async Task LoadData()
    {
        try
        {
            Medicines = (await MedicineService.GetAllMedicinesAsync()).ToList();
            Suppliers = (await SupplierService.GetAllSuppliersAsync()).ToList();
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading data: {ex.Message}");
            await JS.InvokeVoidAsync("alert", $"Error loading data: {ex.Message}");
        }
    }

    private void OpenStockModal(PharmacyManagementSystem.Services.Medicines med, bool stockIn)
    {
        selectedStockMedicine = med;
        isStockIn = stockIn;
        showStockModal = true;
        
        if (isStockIn)
        {
            stockInModel = new StockInTransaction 
            { 
                MedicineId = med.MedicineId, 
                Quantity = 1,
                DeliveryDate = DateTime.Today,
                ExpiryDate = DateTime.Today.AddYears(1)
            };
        }
        else
        {
            stockOutModel = new StockOutTransaction 
            { 
                MedicineId = med.MedicineId, 
                Quantity = 1,
                Reason = "Damaged"
            };
        }
    }

    private async Task SaveStockAdjustment()
    {
        try
        {
            if (isStockIn)
            {
                if (stockInModel.Quantity <= 0) 
                {
                     await JS.InvokeVoidAsync("alert", "Quantity must be greater than 0"); return;
                }
                
                await MedicineService.AddStockInAsync(stockInModel);
                await JS.InvokeVoidAsync("alert", "Stock added successfully!");
            }
            else
            {
                if (stockOutModel.Quantity <= 0)
                {
                     await JS.InvokeVoidAsync("alert", "Quantity must be greater than 0"); return;
                }
                if (selectedStockMedicine.Quantity - stockOutModel.Quantity < 0)
                {
                     await JS.InvokeVoidAsync("alert", "Cannot remove more stock than available!"); return;
                }
                
                await MedicineService.AddStockOutAsync(stockOutModel);
                await JS.InvokeVoidAsync("alert", $"Stock removed successfully. Reason: {stockOutModel.Reason}");
            }
            
            await LoadData();
            showStockModal = false;
        }
        catch (Exception ex)
        {
             await JS.InvokeVoidAsync("alert", $"Error updating stock: {ex.Message}");
             Console.WriteLine(ex.ToString());
        }
    }

    private IEnumerable<PharmacyManagementSystem.Services.Medicines> FilteredMedicines =>
        Medicines.Where(m =>
            (string.IsNullOrWhiteSpace(SelectedCategory) || m.Category == SelectedCategory) &&
            (string.IsNullOrWhiteSpace(SearchTerm) ||
             m.Name.Contains(SearchTerm, StringComparison.OrdinalIgnoreCase) ||
             m.GenericName.Contains(SearchTerm, StringComparison.OrdinalIgnoreCase) ||
             m.Manufacturer.Contains(SearchTerm, StringComparison.OrdinalIgnoreCase)));

    private void OpenModal(PharmacyManagementSystem.Services.Medicines? med)
    {
        currentMedicine = med is null
            ? new PharmacyManagementSystem.Services.Medicines() { ExpiryDate = DateTime.Today.AddYears(2), MinQuantity = 100 }
            : new PharmacyManagementSystem.Services.Medicines
            {
                MedicineId = med.MedicineId,
                Name = med.Name,
                GenericName = med.GenericName,
                Category = med.Category,
                Quantity = med.Quantity,
                MinQuantity = med.MinQuantity,
                Price = med.Price,
                ExpiryDate = med.ExpiryDate,
                Batch = med.Batch,
                Manufacturer = med.Manufacturer,
                StorageLocation = med.StorageLocation,
                SupplierId = med.SupplierId
            };
        showModal = true;
    }

    private async Task SaveMedicine()
    {
        if (string.IsNullOrWhiteSpace(currentMedicine.Name))
        {
            await JS.InvokeVoidAsync("alert", "Medicine name is required!");
            return;
        }
        if (string.IsNullOrWhiteSpace(currentMedicine.Manufacturer))
        {
            await JS.InvokeVoidAsync("alert", "Manufacturer/Supplier must be selected!");
            return;
        }

        try
        {
            if (currentMedicine.MedicineId == 0)
            {
                await MedicineService.AddMedicineAsync(currentMedicine);
                await JS.InvokeVoidAsync("alert", "Medicine added successfully!");
            }
            else
            {
                await MedicineService.UpdateMedicineAsync(currentMedicine);
                await JS.InvokeVoidAsync("alert", $"Medicine '{currentMedicine.Name}' updated!");
            }
        }
        catch (Exception ex)
        {
            await JS.InvokeVoidAsync("alert", $"Database error during save: {ex.Message}");
        }

        showModal = false;
        currentMedicine = new PharmacyManagementSystem.Services.Medicines();
        await LoadData();
        StateHasChanged();
    }

    private async Task DeleteMedicine(PharmacyManagementSystem.Services.Medicines medicine)
    {
        if (await JS.InvokeAsync<bool>("confirm", $"Are you sure you want to delete {medicine.Name}?"))
        {
            try
            {
                await MedicineService.DeleteMedicineAsync(medicine.MedicineId);
                await LoadData();
            }
            catch (Exception ex)
            {
                await JS.InvokeVoidAsync("alert", $"Database error during delete: {ex.Message}");
            }
            StateHasChanged();
        }
    }

    private async Task ExportData()
    {
        if (Medicines is null || !Medicines.Any())
        {
            await JS.InvokeVoidAsync("alert", "No data to export.");
            return;
        }

        var csv = new StringBuilder();
        csv.AppendLine("Name,Generic Name,Category,Quantity,Price,Expiry Date,Manufacturer,Batch");

        foreach (var m in FilteredMedicines)
        {
            var line = $"{m.Name},{m.GenericName},{m.Category},{m.Quantity},{m.Price},{m.ExpiryDate.ToShortDateString()},{m.Manufacturer},{m.Batch}";
            csv.AppendLine(line);
        }

        await JS.InvokeVoidAsync("downloadFile", "inventory_export.csv", csv.ToString(), "text/csv");
        await JS.InvokeVoidAsync("alert", $"Export successful! Downloading {FilteredMedicines.Count()} items.");
    }
}